Parameter/Configure File Description
====================================

Describes all the variables in parameter files. The order of variables presented is the same
as found in saved param files. These parameter files follow a similar
HACC formating. Some strings have either "${step}" or "${healpix}"
that get replace for the specified files by step/healpix pixel. Boolean values can be set by any string from this list: `true`/`True`/`T`/`t`/`1``false`/`False`/`F`/`f`/`0`

Some variables have a "Must be X" in their description. The script will break if it's not set to "x", usually because all other options are deprecated. 

Some variables have a "Should be X" in their description. These are default values used in production and changing these variables wouldn't "break" the run. Some variables have been tuned/validated to a particular value (i.e. red sequence scatter, luminosity rescaling, dust factors). Others are simple plotting or short cuts to help with debugging and testing.

Param file for `lc_resample.py`
---------------
`lc_resample.py` is the main executable of the matchup pipeline. 
These parameter files are stored  in `param_lc_resamp/..`

* `lightcone_fname`: string
  - The location of baseDC2 light cone galaxies. It assums that repalcing "${step}" with the step number will give that step's galaxies.
* `gltcs_fname`: string
  - Galaticus library file location.  It assums that repalcing "${step}" with the step number will give that step's galaxies.
* `gltcs_metadata_ref`: string
  - A single Galacitcus library file from which the metadata is
    pulled. The step doesn't matter since the metadata is the same for
    all files.
* `gltcs_slope_fname`: string
  - **deprecated and ignored but needs a value** Used for older method of linear redshift interpolation of galaxy library properties 
* `halo_shape_fname`: string
  - **deprecated and ignored but needs a value** Used for halo shape information. The information is now wrapped into baseDC2. 
* `halo_shape_red_fname`: string
  - **deprecated and ignored but needs a value** Used for halo shape information. The information is now wrapped into baseDC2. 
* `sod_fname`: string
  - **deprecated and ignored but needs a value** Used for sod halo information. The information is now wrapped into baseDC2. 
  
* `healpix_shear_file`: string
  - File location of calculated lightcone galaxy shears.  It assums that repalcing "${step}" and "${healpix}" with the step and healpix number will give the appropriate file.
  
* `healpix_file`: string
  - Boolean if we are running on multiple healpixels or not. The backend is done differently if we read & write to multiple files. If set to `true`, it will attempt to repalce "${healpix}" with appropirate healpix pixel numbers in the the input`lightcone_fname` file name and ouptut `output_fname` file.
  
* `healpix_pixels`: list(int)
  - The list of healpix pixels numbers to run together. The list is ignored if `healpix_file` is set to `false`
  
* `fake_lensing`: boolean
  - Should be set to `false`. Ignore the shear file and insert zero shear into the catalog
  
* `steps`: list(int)
  - A list of time steps to run on. Must be in descending order. 


* `output_fname`: string
  - The output of for the catalog. As an intermediate step, one file
    will be generated for every time step interval with "${step}"
    being replaced with a time step. The final catalog will
    concatenate all the "step" files into a final "all" file. The
    intermediate step files can be deleted or kept to rerun from the
    intermediate files using the `concatenate_only` flag.

* `load_mask`: boolean
  - Should be set to `true`. Boolean if to load precomputed masks (fast) or computing on the go (slow). The cached masked are calculated by `precompute_mask.py`.
  
* `mask_loc`: string
  - The file location for precomputed galmatcher color cuts. The file
    is generated by `precompute_mask.py`. The cached mask version is
    **not** related to the cosmoDC2 version.
	
* `index_loc`: string
  - The location of index file to match the same galaxies across time
    steps in the galaxy library. This index file is generated by the
    `k_corr_step.py` script.  The cached index mapping flie version is
    **not** related to the cosmoDC2 version.
	
* `use_slope`: boolean
  - Must be set to `true`. Sets the pipeline to linearly interpolate
    galaxy properties--the only option as other options are deprecated.

* `substeps`: int
  - Should be at least `5`. How many substeps to use between time steps for the match up. The
    lightcone galaxies within a single time step are split into redshift bins, called substeps. The
    library galaxies are redshift interpolated to the middle red shift of substep and lightcone are matched to them. More substeps give a better
    matchup, but compute takes longer. 5 substeps perform quite well and
    doesn't take too long.
	

* `use_substep_redshift`: boolean
  - Should be set to `false`. boolean if to use the substep redshift or the galaxy redshift for
    galaxy property interpolation. This should always be set to
    `false` in production to avoid color-z banding. For quick test
    runs with few substeps, setting to `true` will give a better
    matchup but introduce color-z banding.

* `recolor`: boolean
  - Should be set to `false`. It recolors lightcone baseDC2 galaxies by
    calling the galaxy color functions in the cosmoDC2 package. Used
    to test new color distribution in baseDC2 withtout generating a
    new catalog.
	
* `short`: boolean
  - Should be set to `false`. Reduces run time by excluding SED columns from the output
    catalog. Should be set to `false` for production, of course.
  
* `supershort`: boolean
  - Should be set to `false`. Reduces run time even more by excluding almost everything but SDSS
    and LSST colors. Should be set to `false` for production, of
    course.
	
* `cut_small_galaxies`: boolean
  - Should be set to `false`. Removes small galaxies from the catalog
    to reduce run time. 
	
* `cut_small_galaxies_mass`: float
  - Mass limit for the above option. 

* `use_dust_factor`: boolean
  - Must be set to `true` (all other options deprecated) even if no
    additional dust factors are used. Turns on the ability to multiply
    the effect of dust on galaxy properties (i.e. twice the reddening, etc)
  
* `dust_factors`: list(float)
  - Should be empty. The list of dust factors to apply, there's an
    implicit factor of 1 that is automatically added. Adding dust
    factors other than the implicit 1, will introduce color-z banding
    in red sequence cluster galaxies. 

* `ignore_mstar`: boolean
  - Must be set to `true`. For the matchup between baseDC2 and the
    library, don't try to match the stellar mass, only the colors and
    magnitudes. Galacitcus's stellar mass is overwritten by baseDC2
    stellar mass.

* `match_obs_color_red_seq`: boolean
  - Must be set to `true`. Forces red sequence galaxies to match
    expected observed colors in auditing to rest frame colors. 
  
* `red_sequence_transition_mass_start`: float
  - Should be set to `12.5`. All red sequence galaxies in halos below this mass cut don't have
    to match observed colors. In between lower and upper limits, a
    linear proportion from 0% to 100% of red sequence galaxies are
    required to match observed colors
	
* `red_sequence_transition_mass_end`: float
  - Should be set to `13.5` All red sequence galaxies above this cut have to match
    observed colors. In between lower and upper limits, a
    linear proportion from 0% to 100% of red sequence galaxies are
    required to match observed colors

* `red_sequence_scatter_query_gr`: float
  - Should be set to `0.09`. Scatter added to baseDC2 expected red
    sequence colors. Tuned to get the right amount of scatter in
    cluster red sequence.
  
* `red_sequence_scatter_query_ri`: float
  - Should be set to `0.114`. Scatter added to baseDC2 expected red
    sequence colors. Tuned to get the right amount of scatter in
    cluster red sequence.
  
* `red_sequence_scatter_query_iz`: float
  - Should be set to `0.10`. Scatter added to baseDC2 expected red
    sequence colors. Tuned to get the right amount of scatter in
    cluster red sequence.
  
* `red_sequence_scatter_tree_gr`: float
  - Should be set to `0.09`. Scatter added to Galacticus red sequence
    colors before matchup. Tuned to get the right amount of scatter in
    cluster red sequence.
* `red_sequence_scatter_tree_ri`: float
  - Should be set to `0.114`. Scatter added to Galacticus red sequence
    colors before matchup. Tuned to get the right amount of scatter in
    cluster red sequence.
* `red_sequence_scatter_tree_iz`: float
  - Should be set to `0.10`. Scatter added to Galacticus red sequence
    colors before matchup. Tuned to get the right amount of scatter in
    cluster red sequence.
  
* `rescale_bright_luminosity`: boolean
  - Should be set to `true`.  Boolean if to rescale luminosity of
    matched galacticus galaxy to the same brightness of the matched baseDC2
    galaxy.
* `rescale_bright_luminosity_threshold`: float
  - Should be set to `0`. The rest frame magnitude threshold to start rescaling
    the magnitude. With a `0` value all galaxies will be rescaled.

* `ignore_bright_luminosity`: boolean
  - Should be set to `true`. For bright galaxies, don't try to match
    the luminosity between baseDC2 and Galacticus. This is done by
    compressing the bright range into a narrower range and rescaling
    the luminosity (via `rescale_bright_luminosity`) back to the
    original uncompressed value.
* `ignore_bright_luminosity_threshold`: float
  - Should be set to `-21`. The maximum brightness value in the compressed range. 
* `ignore_bright_luminosity_softness`: float
  - Should be set to `2`. The softness of the transition of not compressed to compressed
    Values below threshold plus softness (`-19`) are not compressed. 
* `plot` : boolean
  - Should be set to `false`. boolean if to display various diagnostic plots to display during
    runtime
* `plot_substep`: boolean
  - Should be set to `false`. boolean if to display various diagnostic plots related to
    substepping to display during runtime

* `version_major`: int
  - major version number of catalog
* `version_minor`: int
  - minor version number of catalog
* `version_minor_minor`: int
  - revision/minor-minor version number of catalog


* `concatenate_only`: boolean
  - Should be set to `false` or not defined for production runs. If
    set to `true`, it will skip the matchup process and work from the
    intermediate "steps" files to produce the "all" file. (see
    description for `output_fname`). Allows for fixing errors or bugs
    that occurred between the intermediate "step" file generation and
    final "all" file generation.

* `snapshot`: boolean
  - Should be set to `false` or not defined for production runs. This
    option sets if the cosmoDC2 catalog is a lightcone (i.e. the
    typical run) or if the final catalog will be in discrete
    snapshots.
	
* `resume_at_step`: int
  - Should be not defined for production runs. This skips producing
    intermediate "step" files until it passes the step specified by
    this variable.
  
  
* `no_shear_steps`: list(int)
  - Should be not defined for production runs. For the listed time
    steps (separated by white space), the pipeline will not attempt to
    load the shear file and will insert zero shear. I believe this was
    introduced when we somehow didn't have shears for a couple time
    steps.
	
* `metadata_only`: boolean
  - Should be set to `false` or not defined for production runs. If
    set to `true`, the script will directly skip to the add metedata
    and column units part of the pipeline. It was used fix bugs in
    those areas without rerunning the entire pipeline.

* `verbose`: boolean
  - Sets the printing options for the pipeline. 
  
Param file for `k_corr_step.py` script
---

`k_corr_step.py` precomputes indexes used for linear interpolation of
Galacitcus galaxy properties These param files are stored in
`param_kcorr/..`

* `gltcs_snapshots_ptrn`
  * File location of the galacticus library.
  
* `steps`
  * A list of time steps in descending order.



* `mtree_ptrn`
  * The file pattern for the AlphaQ merger tree. Because of the how
    central galaxies are identified in galacticus, we need the merger
    trees to link central galaxies across time steps.
  
* `mtree_num`
  * The number of merger trees for AlphaQ. These numbers will replace
    "${num}" in `mtree_ptrn`

* `mtree_list`
  * If defined in the param file, the script ignores `mtree_ptrn` and
    `mtree_num` and loads AlphaQ merger trees from this (extremely)
    long explicit list of files. This was required because the merger
    trees were split up into new files to help load balance
    Galactiucs. Galacticus was taking days(?) to run through some very
    long trees, so these trees were isolated and submitted as long
    jobs. These new files don't have a simple pattern to them, so an
    explicit list of files was easier to deal with.

* `output_index_only`
  * Should be set to `true`. If set, it doesn't calculate the slope
  for the linear interpolate for each galaxy property (which is hugely
  space inefficient). Instead is simply stores the index to reorder
  the array of galaxies in one timestep to match the next. Galaxies
  that disappeared (through a merger or some other mechanism) have a
  -1 index, which is dealt with explicitly in the match up pipeline.

* `output_ptrn`
  * The file pattern to output the indexes. The version number is not
    related to the comsoDC2 version number.


